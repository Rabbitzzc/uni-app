import{__spreadArray as e,__assign as t}from"tslib";var n="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto),r=new Uint8Array(16);function o(){if(!n)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return n(r)}for(var i=[],u=0;u<256;++u)i[u]=(u+256).toString(16).substr(1);function a(e,t,n){var r=t&&n||0;"string"==typeof e&&(t="binary"===e?new Array(16):null,e=null);var u=(e=e||{}).random||(e.rng||o)();if(u[6]=15&u[6]|64,u[8]=63&u[8]|128,t)for(var a=0;a<16;++a)t[r+a]=u[a];return t||function(e,t){var n=t||0,r=i;return[r[e[n++]],r[e[n++]],r[e[n++]],r[e[n++]],"-",r[e[n++]],r[e[n++]],"-",r[e[n++]],r[e[n++]],"-",r[e[n++]],r[e[n++]],"-",r[e[n++]],r[e[n++]],r[e[n++]],r[e[n++]],r[e[n++]],r[e[n++]]].join("")}(u)}var c=Object.prototype.hasOwnProperty,s=function(e){return null==e},l=Array.isArray,f=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g;function d(e,t){if(l(e))return e;if(t&&(n=t,r=e,c.call(n,r)))return[e];var n,r,o=[];return e.replace(f,(function(e,t,n,r){return o.push(n?r.replace(/\\(\\)?/g,"$1"):t||e),r})),o}function g(e,t){var n,r=d(t,e);for(n=r.shift();!s(n);){if(null==(e=e[n]))return;n=r.shift()}return e}function p(e){return e._uid||e.uid}var m=new Map;function v(e){var t,n;if(!function(e){if(e){var t=e.tagName;return 0===t.indexOf("UNI-")||"BODY"===t||0===t.indexOf("V-UNI-")}return!1}(e))throw Error("no such element");var r,o,i,u={elementId:(r=e,o=r._id,o||(o=a(),r._id=o,m.set(o,{id:o,element:r})),o),tagName:e.tagName.toLocaleLowerCase().replace("uni-","")};e.__vue__?(i=e.__vue__)&&(i.$parent&&i.$parent.$el===e&&(i=i.$parent),i&&!(null===(t=i.$options)||void 0===t?void 0:t.isReserved)&&(u.nodeId=p(i))):(i=e.__vnode)&&(i.el===e&&(i=i.ctx.parent),i&&!(null===(n=i.type)||void 0===n?void 0:n.__reserved)&&(u.nodeId=p(i)));return"video"===u.tagName&&(u.videoId=u.nodeId),u}var h={input:{input:function(e,t){var n=e.__vue__;n?(n.valueSync=t,n.$triggerInput({},{value:t})):(n=e.__vnode).ctx.exposed.$triggerInput({value:t})}},textarea:{input:function(e,t){var n=e.__vue__;n?(n.valueSync=t,n.$triggerInput({},{value:t})):(n=e.__vnode).ctx.exposed.$triggerInput({value:t})}},"scroll-view":{scrollTo:function(e,t,n){var r=e.__vue__.$refs.main;r.scrollLeft=t,r.scrollTop=n},scrollTop:function(e){return e.__vue__.$refs.main.scrollTop},scrollLeft:function(e){return e.__vue__.$refs.main.scrollLeft},scrollWidth:function(e){return e.__vue__.$refs.main.scrollWidth},scrollHeight:function(e){return e.__vue__.$refs.main.scrollHeight}},swiper:{swipeTo:function(e,t){e.__vue__.current=t}},"movable-view":{moveTo:function(e,t,n){e.__vue__._animationTo(t,n)}},switch:{tap:function(e){e.click()}},slider:{slideTo:function(e,t){var n=e.__vue__,r=n.$refs["uni-slider"],o=r.offsetWidth,i=r.getBoundingClientRect().left;n.value=t,n._onClick({x:(t-n.min)*o/(n.max-n.min)+i})}}};function _(e){var t,n=e.map((function(e){return function(e){if(document.createTouch)return document.createTouch(window,e.target,e.identifier,e.pageX,e.pageY,e.screenX,e.screenY);return new Touch(e)}(e)}));return document.createTouchList?(t=document).createTouchList.apply(t,n):n}var y={getWindow:function(e){return window},getDocument:function(e){return document},getEl:function(e){var t=m.get(e);if(!t)throw Error("element destroyed");return t.element},getOffset:function(e){var t=e.getBoundingClientRect();return Promise.resolve({left:t.left+window.pageXOffset,top:t.top+window.pageYOffset})},querySelector:function(e,t){return"page"===t&&(t="body"),Promise.resolve(v(e.querySelector(t)))},querySelectorAll:function(e,t){var n=[],r=document.querySelectorAll(t);return[].forEach.call(r,(function(e){try{n.push(v(e))}catch(e){}})),Promise.resolve({elements:n})},queryProperties:function(e,t){return Promise.resolve({properties:t.map((function(t){var n=g(e,t.replace(/-([a-z])/g,(function(e){return e[1].toUpperCase()})));return"document.documentElement.scrollTop"===t&&0===n&&(n=g(e,"document.body.scrollTop")),"innerText"===t?n.replace(/\n/g,""):n}))})},queryAttributes:function(e,t){return Promise.resolve({attributes:t.map((function(t){return String(e.getAttribute(t))}))})},queryStyles:function(e,t){var n=getComputedStyle(e);return Promise.resolve({styles:t.map((function(e){return n[e]}))})},queryHTML:function(e,t){return Promise.resolve({html:(n="outer"===t?e.outerHTML:e.innerHTML,n.replace(/\n/g,"").replace(/(<uni-text[^>]*>)(<span[^>]*>[^<]*<\/span>)(.*?<\/uni-text>)/g,"$1$3").replace(/<\/?[^>]*>/g,(function(e){return-1<e.indexOf("<body")?"<page>":"</body>"===e?"</page>":0!==e.indexOf("<uni-")&&0!==e.indexOf("</uni-")?"":e.replace(/uni-/g,"").replace(/ role=""/g,"").replace(/ aria-label=""/g,"")})))});var n},dispatchTapEvent:function(e){return e.click(),Promise.resolve()},dispatchLongpressEvent:function(e){return Promise.resolve()},dispatchTouchEvent:function(e,t,n){n||(n={}),n.touches||(n.touches=[]),n.changedTouches||(n.changedTouches=[]),n.touches.length||n.touches.push({identifier:Date.now(),target:e});var r=_(n.touches),o=_(n.changedTouches),i=_([]);return e.dispatchEvent(new TouchEvent(t,{cancelable:!0,bubbles:!0,touches:r,targetTouches:i,changedTouches:o})),Promise.resolve()},callFunction:function(t,n,r){var o=g(h,n);return o?Promise.resolve({result:o.apply(null,e([t],r,!0))}):Promise.reject(Error("".concat(n," not exists")))},triggerEvent:function(e,t,n){var r=e.__vue__;return r.$trigger&&r.$trigger(t,{},n),Promise.resolve()}};var S,T=Object.assign({},function(e){return{"Page.getElement":function(t){return e.querySelector(e.getDocument(t.pageId),t.selector)},"Page.getElements":function(t){return e.querySelectorAll(e.getDocument(t.pageId),t.selector)},"Page.getWindowProperties":function(t){return e.queryProperties(e.getWindow(t.pageId),t.names)}}}(y),function(e){var t=function(t){return e.getEl(t.elementId,t.pageId)};return{"Element.getElement":function(n){return e.querySelector(t(n),n.selector)},"Element.getElements":function(n){return e.querySelectorAll(t(n),n.selector)},"Element.getDOMProperties":function(n){return e.queryProperties(t(n),n.names)},"Element.getProperties":function(n){var r=t(n),o=r.__vue__||r.attr||{};return r.__vueParentComponent&&(o=Object.assign({},o,r.__vueParentComponent.attrs,r.__vueParentComponent.props)),e.queryProperties(o,n.names)},"Element.getOffset":function(n){return e.getOffset(t(n))},"Element.getAttributes":function(n){return e.queryAttributes(t(n),n.names)},"Element.getStyles":function(n){return e.queryStyles(t(n),n.names)},"Element.getHTML":function(n){return e.queryHTML(t(n),n.type)},"Element.tap":function(n){return e.dispatchTapEvent(t(n))},"Element.longpress":function(n){return e.dispatchLongpressEvent(t(n))},"Element.touchstart":function(n){return e.dispatchTouchEvent(t(n),"touchstart",n)},"Element.touchmove":function(n){return e.dispatchTouchEvent(t(n),"touchmove",n)},"Element.touchend":function(n){return e.dispatchTouchEvent(t(n),"touchend",n)},"Element.callFunction":function(n){return e.callFunction(t(n),n.functionName,n.args)},"Element.triggerEvent":function(n){return e.triggerEvent(t(n),n.type,n.detail)}}}(y));function E(e){return UniViewJSBridge.publishHandler("onAutoMessageReceive",e)}function w(e){return e.__wxWebviewId__?e.__wxWebviewId__:e.privateProperties?e.privateProperties.slaveId:e.$page?e.$page.id:void 0}function P(e){return e.route||e.uri}function b(e){return e.options||e.$page&&e.$page.options||{}}function I(e){return{id:w(e),path:P(e),query:b(e)}}function O(e){var t=function(e){return getCurrentPages().find((function(t){return w(t)===e}))}(e);return t&&t.$vm}function M(e,t){return e._uid===t||e.uid===t}function C(e,t,n){var r,o,i;if(void 0===n&&(n=!1),n)if(e.component&&M(e.component,t))i=e.component;else{var u=[];e.children instanceof Array?u=e.children:(null===(o=null===(r=e.component)||void 0===r?void 0:r.subTree)||void 0===o?void 0:o.children)&&(u=e.component.subTree.children),u.find((function(e){return i=C(e,t,!0)}))}else e&&(M(e,t)?i=e:e.$children.find((function(e){return i=C(e,t)})));return i}function x(e,t){var n=O(e);if(n)return N(n)?C(n.$.subTree,t,!0):C(n,t)}function $(e,t){var n,r=e.$data||e.data;return e&&(n=t?g(r,t):Object.assign({},r)),Promise.resolve({data:n})}function k(e,t){if(e){var n=N(e);Object.keys(t).forEach((function(r){n?(e.$data||e.data)[r]=t[r]:e[r]=t[r]}))}return Promise.resolve()}function A(e,t,n){return N(e)&&(e=e.$vm||e.ctx),new Promise((function(r,o){var i,u;if(!e)return o(S.VM_NOT_EXISTS);if(!e[t]&&!(null===(u=e.$.exposed)||void 0===u?void 0:u[t]))return o(S.METHOD_NOT_EXISTS);var a,c=e[t]?e[t].apply(e,n):(i=e.$.exposed)[t].apply(i,n);!(a=c)||"object"!=typeof a&&"function"!=typeof a||"function"!=typeof a.then?r({result:c}):c.then((function(e){r({result:e})}))}))}function N(e){return!e.$children}function W(){return window.__uniapp_x_}UniViewJSBridge.subscribe("sendAutoMessage",(function(e){var t=e.id,n=e.method,r=e.params,o={id:t},i=T[n];if(!i)return o.error={message:n+" unimplemented"},E(o);try{i(r).then((function(e){e&&(o.result=e)})).catch((function(e){o.error={message:e.message}})).finally((function(){E(o)}))}catch(e){o.error={message:e.message},E(o)}})),function(e){e.VM_NOT_EXISTS="VM_NOT_EXISTS",e.METHOD_NOT_EXISTS="METHOD_NOT_EXISTS"}(S||(S={}));var B=1,D={};function V(e,t){var n=0;t&&(n=B++,D[n]=t);var r={data:{id:n,type:"automator",data:e}};console.log("postMessageToUniXWebView",r),window.__uniapp_x_.postMessage(JSON.stringify(r))}var q=new Map,L=function(e){return new Promise((function(n,r){var o=q.values().next().value;if(o){var i=e.method;if("onOpen"===i)return U(o,n);if(i.startsWith("on"))return o.instance[i]((function(e){n(e)}));"sendMessage"===i&&(i="send"),o.instance[i](t(t({},e),{success:function(e){n({result:e}),"close"===i&&q.delete(q.keys().next().value)},fail:function(e){r(e)}}))}else r({errMsg:"socketTask not exists."})}))};function U(e,t){if(e.isOpend)t({data:e.openData});else{var n=setInterval((function(){e.isOpend&&(clearInterval(n),t(e.openData))}),200);setTimeout((function(){clearInterval(n)}),2e3)}}var R=["stopRecord","getRecorderManager","pauseVoice","stopVoice","pauseBackgroundAudio","stopBackgroundAudio","getBackgroundAudioManager","createAudioContext","createInnerAudioContext","createVideoContext","createCameraContext","createMapContext","canIUse","startAccelerometer","stopAccelerometer","startCompass","stopCompass","hideToast","hideLoading","showNavigationBarLoading","hideNavigationBarLoading","navigateBack","createAnimation","pageScrollTo","createSelectorQuery","createCanvasContext","createContext","drawCanvas","hideKeyboard","stopPullDownRefresh","arrayBufferToBase64","base64ToArrayBuffer"],X=new Map,H=["onCompassChange","onThemeChange","onUserCaptureScreen","onWindowResize","onMemoryWarning","onAccelerometerChange","onKeyboardHeightChange","onNetworkStatusChange","onPushMessage","onLocationChange","onGetWifiList","onWifiConnected","onWifiConnectedWithPartialInfo","onSocketOpen","onSocketError","onSocketMessage","onSocketClose"],j={},J=/^\$|Sync$|Window$|WindowStyle$|sendHostEvent|sendNativeEvent|restoreGlobal|requireGlobal|getCurrentSubNVue|getMenuButtonBoundingClientRect|^report|interceptors|Interceptor$|getSubNVueById|requireNativePlugin|upx2px|hideKeyboard|canIUse|^create|Sync$|Manager$|base64ToArrayBuffer|arrayBufferToBase64|getLocale|setLocale|invokePushCallback|getWindowInfo|getDeviceInfo|getAppBaseInfo|getSystemSetting|getAppAuthorizeSetting|initUTS|requireUTS|registerUTS/,F=/^on|^off/;function Y(e){return J.test(e)||-1!==R.indexOf(e)}var z={getPageStack:function(){return Promise.resolve({pageStack:getCurrentPages().map((function(e){return I(e)}))})},getCurrentPage:function(){var e=getCurrentPages(),t=e.length;return new Promise((function(n,r){t?n(I(e[t-1])):r(Error("getCurrentPages().length=0"))}))},callUniMethod:function(e,n){var r=e.method,o=e.args;return new Promise((function(e,i){if("connectSocket"!==r){var u,a;if(H.includes(r)){X.has(r)||X.set(r,new Map);var c=o[0],s=function(e){n({id:c,result:{method:r,data:e}})};return r.startsWith("onSocket")?L({method:r.replace("Socket","")}).then((function(e){return s(e)})).catch((function(e){return s(e)})):(X.get(r).set(c,s),uni[r](s)),e({result:null})}if(r.startsWith("off")&&H.includes(r.replace("off","on"))){var l=r.replace("off","on");if(X.has(l)){var f=o[0];if(void 0!==f){var d=X.get(l).get(f);uni[r](d),X.get(l).delete(f)}else{X.get(l).forEach((function(e){uni[r](e)})),X.delete(l)}}return e({result:null})}if(r.indexOf("Socket")>0)return L(t({method:r.replace("Socket","")},o[0])).then((function(t){return e(t)})).catch((function(e){return i(e)}));if(!uni[r])return i(Error("uni."+r+" not exists"));if(Y(r))return e({result:uni[r].apply(uni,o)});var g=[Object.assign({},o[0]||{},{success:function(t){setTimeout((function(){e({result:t})}),"pageScrollTo"===r?350:0)},fail:function(e){i(Error(e.errMsg.replace(r+":fail ","")))}})];uni[r].apply(uni,g)}else(u=o[0].id,a=o[0].url,new Promise((function(e,t){var n=uni.connectSocket({url:a,success:function(){e({result:{errMsg:"connectSocket:ok"}})},fail:function(){t({result:{errMsg:"connectSocket:fail"}})}});q.set(u,{instance:n,isOpend:!1}),n.onOpen((function(e){q.get(u).isOpend=!0,q.get(u).openData=e}))}))).then((function(t){return e(t)})).catch((function(e){return i(e)}))}))},mockUniMethod:function(e){var t=e.method;if(!uni[t])throw Error("uni.".concat(t," not exists"));if(!function(e){return!F.test(e)}(t))throw Error("You can't mock uni.".concat(t));var n,r=e.result,o=e.functionDeclaration;return s(r)&&s(o)?(j[t]&&(uni[t]=j[t],delete j[t]),Promise.resolve()):(n=s(o)?Y(t)?function(){return r}:function(e){setTimeout((function(){r.errMsg&&-1!==r.errMsg.indexOf(":fail")?e.fail&&e.fail(r):e.success&&e.success(r),e.complete&&e.complete(r)}),4)}:function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];return new Function("return "+o)().apply(n,t.concat(e.args))},n.origin=j[t]||uni[t],j[t]||(j[t]=uni[t]),uni[t]=n,Promise.resolve())},captureScreenshot:function(e){return new Promise((function(t,n){W()?V({action:"captureScreenshot",args:e},(function(e,r){e?n(Error("captureScreenshot fail: ".concat(e))):t(r)})):n(Error("captureScreenshot fail: supported only on the app platform."))}))},socketEmitter:function(e){return new Promise((function(n,r){(function(e){return new Promise((function(n,r){if(q.has(e.id)){var o=q.get(e.id),i=o.instance,u=e.method,a=e.id;if("onOpen"==u)return U(o,n);if(u.startsWith("on"))return i[u]((function(e){n({method:"Socket.".concat(u),id:a,data:e})}));i[u](t(t({},e),{success:function(t){n(t),"close"===u&&q.delete(e.id)},fail:function(e){r(e)}}))}else r({errMsg:"socketTask not exists."})}))})(e).then((function(e){return n(e)})).catch((function(e){return r(e)}))}))}},G=z,K={getData:function(e){return $(O(e.pageId),e.path)},setData:function(e){return k(O(e.pageId),e.data)},callMethod:function(e){var t,n=((t={})[S.VM_NOT_EXISTS]="Page[".concat(e.pageId,"] not exists"),t[S.METHOD_NOT_EXISTS]="page.".concat(e.method," not exists"),t);return new Promise((function(t,r){A(O(e.pageId),e.method,e.args).then((function(e){return t(e)})).catch((function(e){r(Error(n[e]))}))}))},callMethodWithCallback:function(e){var t,n=((t={})[S.VM_NOT_EXISTS]="callMethodWithCallback:fail, Page[".concat(e.pageId,"] not exists"),t[S.METHOD_NOT_EXISTS]="callMethodWithCallback:fail, page.".concat(e.method," not exists"),t),r=e.args[e.args.length-1];A(O(e.pageId),e.method,e.args).catch((function(e){r({errMsg:n[e]})}))}};function Q(e){return e.nodeId||e.elementId}var Z={getData:function(e){return $(x(e.pageId,Q(e)),e.path)},setData:function(e){return k(x(e.pageId,Q(e)),e.data)},callMethod:function(e){var t,n=Q(e),r=((t={})[S.VM_NOT_EXISTS]="Component[".concat(e.pageId,":").concat(n,"] not exists"),t[S.METHOD_NOT_EXISTS]="component.".concat(e.method," not exists"),t);return new Promise((function(t,o){A(x(e.pageId,n),e.method,e.args).then((function(e){return t(e)})).catch((function(e){o(Error(r[e]))}))}))}},ee={};Object.keys(G).forEach((function(e){ee["App."+e]=G[e]})),Object.keys(K).forEach((function(e){ee["Page."+e]=K[e]})),Object.keys(Z).forEach((function(e){ee["Element."+e]=Z[e]}));var te,ne,re=process.env.UNI_AUTOMATOR_WS_ENDPOINT;function oe(e){ne.send({data:JSON.stringify(e)})}function ie(e){var t=JSON.parse(e.data),n=t.id,r=t.method,o=t.params,i={id:n},u=ee[r];if(!u){if(te){var a=te(n,r,o,i);if(!0===a)return;u=a}if(!u)return i.error={message:r+" unimplemented"},oe(i)}try{u(o,oe).then((function(e){e&&(i.result=e)})).catch((function(e){i.error={message:e.message}})).finally((function(){oe(i)}))}catch(e){i.error={message:e.message},oe(i)}}function ue(e){void 0===e&&(e={}),(ne=uni.connectSocket({url:e.wsEndpoint||re,complete:function(){}})).onMessage(ie),ne.onOpen((function(t){e.success&&e.success(),console.log("已开启自动化测试...")})),ne.onError((function(e){console.log("automator.onError",e)})),ne.onClose((function(){e.fail&&e.fail({errMsg:"$$initRuntimeAutomator:fail"}),console.log("automator.onClose")}))}te=function(e,t,n,r){var o=n.pageId,i=function(e){var t=getCurrentPages();if(!e)return t[t.length-1];return t.find((function(t){return t.$page.id===e}))}(o);return i?(i.$page.meta.isNVue,UniServiceJSBridge.publishHandler("sendAutoMessage",{id:e,method:t,params:n},o),!0):(r.error={message:"page["+o+"] not exists"},oe(r),!0)},UniServiceJSBridge.subscribe("onAutoMessageReceive",(function(e){oe(e)})),setTimeout((function(){if(W())V({action:"ready"});else{if(re&&re.endsWith(":0000"))return;ue()}}),500),window.initRuntimeAutomator=ue,window.onPostMessageFromUniXWebView=function(e,t,n){console.log("onPostMessageFromUniXWebView",e,t,n,D);var r=D[e];r&&(delete D[e],r(n,t))};
